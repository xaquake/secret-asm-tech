;	   /\       /\
;	  / ".-'"'-." \
;	 ;   _     _   ;
;	 ;  (o)   (o) _;_       __________________________________
;	  \   = Y =  (,,,)     /\                                 \
;	   '   '-'   | -,      \_|    Автор: xaquake              |
;	  .(________/   ;        |    Дата: 01.2025               |
;	 . __ (MASM) '  ;        |    Компилятор: MASM64          |
;	/     )        ,         |    Проект: Get запрос httpbin  |
;	;  --'          ;        |   _____________________________|_
;	 . __  . , __  .          \_/_______________________________/
;	  (,,,)   (,,,)
; 
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡀⢐⡂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣤⣤⣴⣶⣾⣿⣟⣭⣿⣿⣿⣿⣿⣦⣛⠲⣤⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣾⣿⣿⣿⣿⣿⣿⠿⠷⢋⣉⣿⣿⣿⣿⣿⣿⣿⣅⠛⣿⣿⣷⣦⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣶⣿⣿⣿⣿⣿⣿⡏⠉⣭⣤⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣜⡛⠻⣿⣿⣿⣿⣦⣄⠀⠀⠀⠀⠀⠀⠀Libs: kernel32.lib ws2_32.lib⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣿⣿⣿⣿⣭⡴⢶⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣤⢙⣿⣿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⣿⣿⣿⣿⣿⣿⣿⣠⢶⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣌⠻⢿⣿⣿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⣿⣿⣿⣿⣿⣿⣿⢋⣡⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠷⣆⣽⣿⣿⣿⣿⣿⣿⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⣏⠠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⢉⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⡿⡷⠌⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠌⠙⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣷⡘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⣿⣿⣿⣿⣿⣿⣿⣀⠺⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⢸⣿⣿⣿⣿⣿⣿⠟⣃⣤⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⢸⣿⣿⣿⣿⣿⡿⠶⣌⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣿⡿⠿⡿⠿⣿⣿⣿⡆⢸⣿⣿⡿⣛⣉⣉⣙⣿⣟⣛⣻⣿⣿⣿⡆⣽⣯⣥⣴⣶⣶⣾⣝⠿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣿⣿⣿⣿⣷⣶⣶⣦⣽⣧⣬⣭⣬⣾⣿⠏⠉⠉⠛⠛⠻⠿⢿⣿⣿⣿⡜⢿⣿⣿⣿⣿⣿⡋⠑⢦⣍⣋⣙⠻⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⢀⣠⢶⣿⣿⣿⠟⣩⡿⠛⠉⠉⢠⣿⣿⣿⣿⢳⣿⠀⠀⠀⠀⠀⠀⠀⠀⠙⣿⣿⣿⣮⠻⣿⣿⣿⣿⣿⣿⣦⣽⣿⣿⣷⡌⢿⣿⣿⣿⡿⠀⠀⢀⠀⠀⠀⠀
; ⠀⠀⣠⣶⡿⠗⠺⣿⡏⢾⣿⣿⠃⣼⡏⠀⠀⠀⢀⣾⣿⣿⣿⣿⡇⢿⡄⠀⠀⠀⠀⠀⠀⠀⠀⢹⣿⣿⣿⣷⣬⣝⡛⠛⠿⠿⠿⠛⣛⣛⣭⣴⠎⣿⣿⡿⠁⠀⣰⣿⣿⡄⠀⠀
; ⠀⠀⣿⣿⣷⣶⣤⣼⣷⢸⣿⠃⢸⣿⠁⠀⠀⠀⣸⣿⣿⣿⣿⣿⣷⣄⠹⣦⣤⣀⡀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣥⣾⡿⠋⠀⠀⣼⣿⣿⣿⣷⠀⠀
; ⠀⠀⣿⣿⣿⣿⣿⣿⣿⠘⣿⡀⢸⡿⠀⠀⠀⢠⣿⣿⠋⣠⡶⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣶⣾⣿⣿⣿⣿⣿⣿⡿⠛⠛⠛⠛⠛⠉⠉⢛⡟⠋⠀⠀⣠⡞⢻⣿⣿⣿⣿⡀⠀
; ⠀⢸⣿⣿⣿⣿⠀⣿⣿⣤⣿⣿⣾⣷⣤⣤⣶⣿⣿⠇⣸⠏⠀⠀⠙⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀⠀⠀⢠⣶⣿⣿⣿⠋⠀⣀⣴⡾⠿⣿⣄⠙⣻⢿⣿⠀⡀
; ⠀⣿⣿⣿⣿⣿⠃⣿⡋⢻⣿⣿⣿⣿⣿⣿⣿⣿⡟⢠⠇⠀⠀⠀⠀⠀⠹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⣿⣿⣿⣿⠃⣴⣿⣿⣿⣿⣶⣦⣬⡀⢻⣶⣾⣄⣏
; ⠀⣿⣿⣿⣿⣿⣄⣿⣧⠀⢻⣿⣿⠟⣩⣿⣿⣿⡇⣼⠀⠀⠀⠀⠀⠀⠀⢹⣿⣿⣿⡿⠟⠛⠛⠛⠉⠻⠿⣿⣧⣤⣄⠀⠀⣿⣿⣿⠇⢰⣿⣿⣿⣿⣿⣿⣿⣿⠃⢠⣿⣿⡯⣏
; ⠀⣿⣿⣿⡿⣿⣿⣿⣿⣷⡀⠛⠋⢸⣿⣿⣿⣿⣷⣿⣤⣴⣿⣿⣶⣤⣴⣿⣿⠟⣡⣾⣿⣿⣿⣿⣿⣷⣶⠀⣸⣿⣿⣷⣄⣿⣿⡿⢀⣿⣿⣿⣿⣿⣿⣿⣿⣿⡀⣿⣿⣿⡿⣯
; ⠀⠙⣟⣅⠘⣿⡛⠻⣿⣿⣷⡄⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢀⣿⣿⣿⣿⣿⣿⣿⡇⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⠃⢿⣿⡿⠀⢀
; ⣴⣿⣿⣿⣧⠙⢿⣦⣄⡙⠻⠿⣆⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠇⢸⣿⣿⣿⣿⣿⣿⣿⠇⠀⠉⣉⣉⣉⣁⣀⣀⠐⣾⣶⣶⣿⡄⠀⠀
; ⠘⣿⣿⣿⣿⡧⣸⣿⣿⣿⣿⣿⣶⡀⢸⣿⡟⠛⣟⠻⣿⣛⠻⢟⠻⠿⢟⣛⡟⢉⣉⣉⢱⣲⡯⣴⣶⡟⠀⣿⣿⣿⣿⣿⣿⣿⣿⠰⣿⣿⣿⣿⣿⣿⣿⣿⠘⣿⣿⣿⣿⣿⠀⣄
; ⠀⢻⣿⣿⣿⠇⣿⣿⣿⠿⢿⣿⣿⣧⢠⡇⣿⡔⣿⣗⣿⣿⢶⣿⣿⡷⣿⣿⣿⣾⣿⣿⢸⣿⠇⠟⣛⣅⢰⣿⣿⣿⣿⣿⣿⣿⡏⢰⣿⣿⣿⣿⣿⣿⣿⣿⠆⠙⣿⣿⣿⣿⠀⠀
; ⠀⢸⣿⣟⣫⡄⠨⣥⣴⣶⣿⣿⣿⣿⢨⡇⣹⡁⣛⡏⠻⠛⠛⣿⣛⠃⢛⣻⣏⣨⣭⣥⢸⣿⣿⣿⣿⡇⣸⣿⣿⣿⣿⣿⣿⣿⡇⢸⣿⣿⣿⣿⣿⣿⣿⡇⠈⣷⣌⠻⣿⡏⠀⠀
; ⠀⠀⠛⣫⣤⣶⣦⡀⠉⠉⠉⢛⣿⣿⠚⣇⣿⡇⣿⣿⣿⣿⡇⢿⣿⡿⢺⣿⣿⣿⣿⣿⢸⣿⠇⢛⣩⣡⣿⣿⣿⣿⣿⣿⠟⠋⠀⠈⣿⣿⣿⣿⡿⢋⣤⣤⣄⡈⢻⣷⣌⠃⠀⠀
; ⠀⠀⢸⣿⣿⣿⣿⣿⡆⢰⣿⡿⠋⠁⠀⢹⣾⣧⣌⣛⣘⣛⣃⣘⣛⣃⣘⣛⣫⣬⣭⣥⣴⣶⣿⣟⣵⣿⣿⣿⣿⡿⠛⠁⠀⠀⠀⠀⠈⢿⣿⣿⡇⢸⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀
; ⠀⠀⢸⣿⣿⣿⡿⠿⠟⠛⠁⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠛⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⣿⣧⡘⠻⣿⣿⣿⣿⣿⡇⠀⠀⠀
; ⠀⠀⠘⠛⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣿⣿⣿⣿⣿⠟⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠻⢶⣮⣛⣿⣿⣿⠃⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣧⣼⣶⣦⣍⡙⠻⠿⠟⢛⣋⣩⣴⣿⣿⣿⠿⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠉⠛⠉⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⠻⠿⠛⠛⠛⠛⠻⠿⠿⠿⠿⠟⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀



extern GetStdHandle:proc
extern WriteConsoleA:proc
extern ExitProcess:proc
extern WSAStartup:proc
extern WSACleanup:proc
extern socket:proc
extern connect:proc
extern send:proc
extern recv:proc
extern closesocket:proc
extern htons:proc
extern inet_addr:proc
extern setsockopt:proc

; ВСЕ ЧТО Я НИЖЕ БУДУ ПОМЕЧАТЬ "Б" ЭТО БАЙТ А НЕ БИТ!


; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐
; 卐                                                          卐
; 卐      learn.microsoft.com/ru-ru/windows/win32/winsock     卐
; 卐                                                          卐
; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐

.const
    AF_INET             equ 2 ; IPv4
    SOCK_STREAM         equ 1 ; TCP
    IPPROTO_TCP         equ 6
    INADDR_NONE         equ 0FFFFFFFFh
    INVALID_SOCKET      equ -1
    SOCKET_ERR          equ -1
    SOL_SOCKET          equ 0FFFFh
    SO_RCVTIMEO         equ 1006h
    SO_SNDTIMEO         equ 1005h
    WSA_VERSION         equ 0202h
    SOCKET_TIMEOUT      equ 5000 ; хуй знает не работает :\
    PORT                equ 80
    RESP_BUF            equ 1488 ; буфер ответа
   ; ██╗██╗  ██╗ █████╗  █████╗ 
   ;███║██║  ██║██╔══██╗██╔══██╗
   ;╚██║███████║╚█████╔╝╚█████╔╝
   ; ██║╚════██║██╔══██╗██╔══██╗
   ; ██║     ██║╚█████╔╝╚█████╔╝
   ; ╚═╝     ╚═╝ ╚════╝  ╚════╝ 
    OUT_BUF             equ 1939 ; буфер консоли
   ; ██╗ █████╗ ██████╗  █████╗ 
   ;███║██╔══██╗╚════██╗██╔══██╗
   ;╚██║╚██████║ █████╔╝╚██████║
   ; ██║ ╚═══██║ ╚═══██╗ ╚═══██║
   ; ██║ █████╔╝██████╔╝ █████╔╝
   ; ╚═╝ ╚════╝ ╚═════╝  ╚════╝ 

;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣠⣤⠤⢤⣔⣒⣒⣒⣒⣠⠤⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⡤⣶⣿⣿⣷⣛⣿⣍⣉⣏⣂⢠⣤⣄⠀⢩⣝⠛⠶⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣶⣾⣽⣿⣿⣿⣿⣷⣷⠻⠟⣿⡿⠿⠿⠷⢦⡿⢾⣿⣽⣷⣄⠀⠙⢳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣴⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡍⠻⣦⣄⣲⣤⡀⣀⣰⡀⣩⣿⡄⠰⣄⡙⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣿⣿⡏⠉⠹⣿⡋⠻⣶⣿⣿⣧⣤⣾⣷⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣤⣴⣿⣃⠈⠿⣿⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣿⢿⣿⣛⣛⣛⣟⣟⠉⢙⣛⡻⢿⡿⠷⣦⣿⣿⣿⣿⣿⣿⠇⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣻⣿⣿⣿⣶⣶⣿⣿⣿⣿⣿⠻⠙⠁⣴⡞⢋⡓⢮⡹⣷⣦⣝⢿⣿⣿⣿⡟⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠆⠀⠐⢿⣷⣌⠃⣸⡇⠀⢿⣿⣧⣿⣿⡟⠁⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⠿⡿⣿⢶⣄⣀⣘⠉⠛⠿⠋⠀⠀⣸⣿⣯⣿⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⣿⣿⡿⢛⣭⣿⠛⠉⣹⢫⣭⣽⣿⣿⣖⣛⣫⠭⠭⠽⠽⡿⠿⠿⠭⠭⠽⢿⣒⣲⣾⡭⣟⡁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢿⣿⣿⣿⣿⣿⡷⢛⣯⣾⣶⣿⣿⣖⣛⣯⣭⣿⣷⣶⣶⡿⠿⠿⢿⣿⣿⣿⣿⣿⣷⣶⣶⣾⣿⣭⡓⢿⡷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠛⠻⣿⣿⣤⣼⣟⣯⣷⣿⣿⣿⣿⠛⠛⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠁⠀⠉⠁⠈⠙⣿⣿⣷⣽⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⣫⣿⣿⣿⣿⣿⣾⣿⣿⣛⣒⣤⣤⣤⣀⣀⣀⣀⣀⣀⣀⣀⣀⡀⠀⠀⠀⠀⠀⠈⢿⣿⣯⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡼⢿⣿⣿⡿⡏⠉⠈⠉⠙⠛⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣶⠟⠻⠿⠆⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣶⣤⡉⠁⠀⠀⠀⠀⠀⠀⠛⠿⠟⠻⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣿⣿⢀⣹⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⢤⣀⣀⣉⣽⡿⢻⠿⠿⠛⠁⠹⣿⡿⠟⠛⢻⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣿⢸⡟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡾⠁⠀⠀⠀⠀⠏⠻⢶⠖⠁⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀ЗА ВЕЛИКИЙ MASM!
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠦⢉⣀⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⡁⢀⣀⣀⠀⢀⠸⡄⠀⠈⢒⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢦⠀⠀⣤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣾⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠛⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡼⠋⠀⠺⣿⣿⣿⣿⣿⣿⡟⠛⣧⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠋⢀⠄⠀⠀⠀⠀⠀⠀⠀⠀⠜⠁⠠⣴⣾⣛⣿⣿⣿⣿⣿⠀⠀⠈⢡⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⢸⡄⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⠿⠛⠉⠉⢉⣉⣉⣉⠉⢻⣖⠀⣼⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡀⠘⢆⡄⠀⠀⠀⠶⠈⠚⣧⠌⠁⠀⠀⣀⣿⣿⣿⣿⣿⠏⠀⢹⣷⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⠃⢧⣀⢸⢿⡄⠀⢰⣿⣤⣴⣿⣦⡀⠀⠀⠀⠀⠀⠈⠉⠁⠀⠀⣼⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⠀⠈⠹⣞⢯⣻⣦⣤⣿⣿⣿⣿⣿⣿⣦⣀⣐⣤⣀⣀⣰⣄⣀⣸⡿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⡿⣿⡄⠀⠀⠈⠻⣧⡙⢿⣿⣿⣿⣿⣻⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⠞⠋⠀⣤⣧⢿⣆⠀⠀⠀⠈⠛⠶⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣾⡿⠃⠀⠀⠀⠀⠚⠒⠛⣦⡀⠀⠀⠀⠀⠀⠙⠻⢿⣿⣿⣿⣿⣟⣭⡿⠟⠁⠀⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣠⠶⠚⢉⣿⣿⡏⠀⠀⠀⠀⠀⠀⣇⠀⠘⠙⢷⡄⠀⠀⠀⠀⠀⠀⠀⠉⠙⢿⣿⠟⠁⠀⠀⠀⢰⡟⢦⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⢀⣠⡴⠶⠚⠉⠁⠀⠀⠄⢨⣿⡟⠀⠀⠀⠀⠀⠀⠀⠈⣧⡀⠀⠨⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣦⡀⠀⠀⠀⢸⡇⠀⠉⠛⢦⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠤⠔⠋⠉⠀⠀⠀⠀⠀⠀⠀⠀⢀⣼⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢣⡄⢠⠘⣧⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣿⠀⠀⠀⠘⣧⠀⢠⡀⠀⠈⡛⠳⢦⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢩⣿⠃⠀⠀⠀⡆⠀⠀⠀⠀⠀⠀⠀⠀⢿⢰⡀⠈⢳⣄⠀⠀⠀⠰⢿⣿⣿⣿⠟⣧⠀⠀⠀⣿⡀⢸⣿⡄⣤⢿⣆⠠⠀⠈⠙⢳⣤⡀⠀⠀⠀⠀
;⠀⠀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠀⠀⠀⢀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠈⠘⣷⣠⢀⠻⣆⠀⠀⠀⢸⣿⣿⣿⠀⠘⡄⠀⢀⡿⢹⣾⡅⠖⡈⠈⠻⣧⣂⡖⠀⠀⠀⠙⠶⣄⠀⠀
;⠀⠀⠀⠀⢀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⡷⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣯⣽⣾⣧⣽⣷⡄⠀⣾⣿⣿⣿⣦⠀⠉⠀⢸⡇⠘⢿⣿⡀⢷⠀⠀⠹⣿⣷⣴⡄⠀⠀⠀⠈⢻⡆
;⣆⠀⢀⡞⣼⡇⣠⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢧⠀⠀⠀⠀⠀⢀⣠⣠⣤⣾⢻⣿⣿⣿⣿⣯⣷⣄⣿⣿⣿⣿⣿⣆⠀⠀⢸⣷⡄⣿⣿⣿⡄⠇⠀⠀⠘⢿⣿⡿⠀⠀⠀⠀⢨⡜
;⠻⣧⡻⣷⢿⣿⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⢀⠐⣠⣄⣿⣿⣿⣿⠛⢷⠟⣵⠏⠻⠛⢿⣿⣿⣿⣿⣿⣿⣿⡀⠀⢸⡿⢀⣿⡿⣿⣿⣌⣟⣧⡀⠈⢿⡄⠀⠀⠀⠀⠀⠇
;⣦⣈⡟⠹⣾⠛⣿⣿⣏⠀⠀⠀⠀⠀⠠⠄⠀⠸⠻⣶⡶⠟⠛⠋⠉⣽⣿⠇⠀⠀⠘⠉⠤⠀⠀⠰⣶⡿⢿⣿⣿⣿⣿⣧⠀⢸⡇⠀⠟⣅⡿⠙⠿⢷⣯⣅⣀⡀⠁⠀⠀⠀⠀⠀⢨
;⣿⣿⣷⣄⠹⣦⡰⣿⣿⠀⠀⠀⠀⢀⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣿⣿⠂⠀⠀⠀⠀⠀⠀⠤⢤⣾⡃⠨⢿⣿⣿⣿⣿⣇⣸⡇⠀⠀⠻⡆⠀⠀⠀⠘⠉⠻⣿⠃⠀⠀⠀⠀⠀⠸
;⢻⣿⣿⠹⣷⣌⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠀⣿⡿⢃⠀⠀⠀⠀⠀⠀⠘⠀⠀⠘⢻⣿⣾⣿⣿⣿⣿⣿⡿⠘⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⢸⣿⣷⣌⢻⣿⣿⣿⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣷⣄⣠⣀⡀⠀⠀⠀⠀⠀⠀⠈⠋⣁⢚⢿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠀⠀⠀⠀⠀⠀⠀
;⣶⣄⠙⠿⣿⣦⡹⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⠻⣾⣿⣷⣤⠀⠀⠀⠀⠀⠀⡈⡉⠀⢿⣿⣿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣼⠏⠀⠀⠀⠀⠀⠀⠀
;⠈⢻⣷⣤⡈⠻⢿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠛⠳⢧⣤⣤⡀⠀⠠⡄⠁⠀⠈⣿⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⡞⠁⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠻⡿⠿⣷⣦⣽⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠻⣿⣷⠄⠀⠤⣄⣠⣿⡇⠀⠀⠀⠀⠀⠀⠀⢀⣾⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⣀⡈⢹⣿⣿⣛⣛⣂⣀⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠿⣷⣶⣋⣿⣿⠁⠀⠀⠀⠀⠀⣀⣴⡿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀


; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐
; 卐                                        卐
; 卐      Данные для отправки запроса       卐
; 卐                                        卐
; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐

.data
    ws_data         byte 400 dup(0)
    req             byte "GET / HTTP/1.1", 13, 10
                    byte "Host: httpbin.org", 13, 10
                    byte "Connection: close", 13, 10
                    byte 13, 10, 0
    req_len         qword 0
    response_buf    byte RESP_BUF dup(0)
    output_buf      byte OUT_BUF dup(0)
    bw              dword 0 ; LPDWORD для кол-ва байт
    ip_addr         byte "54.158.135.159", 0 ; айпи адрес httpbin.org . по крайней мере сейчас рабочий!

;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠋⡿⢿⠙⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⢴⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⣴⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⣴⢀⠀⠀⠀⠀⠋⡿⢿⠉⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⡷⣿⣿⣿⣿⣿⢉⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⢿⠙⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⣄⣷⣿⣿⣿⣿⢻⠘⠋⡿⣿⣿⣿⣿⣿⣿⣿⣿⢿⠉⠀⠀⠀
;	⠀⠋⡿⠻⠉⠀⠀⠀⠀⣄⣷⣿⣿⣿⣿⣿⣿⣿⣿⣴⢀⣄⣶⣿⣿⣿⣿⠿⠙⠀
;	⡷⣿⣿⣿⣿⠿⠉⠀⠀⠁⠀⣏⣿⣿⣿⣿⣿⣿⢘⠀⠀⠀⠀⣀⣶⣿⣿⣿⣿⢴
;	⠀⣄⣷⣿⣿⣿⣿⠿⠉⠋⡿⣿⣿⣿⣿⣿⣿⣿⣿⢻⠙⠀⠀⠀⠀⣄⣧⣴⢀⠀
;	⠀⠀⠀⣄⣷⣿⣿⣿⣿⣿⣿⣿⣿⣴⢀⣄⣷⣿⣿⣿⣿⠿⠈⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⣄⣷⣿⣿⣿⣿⣴⢀⠀⠀⠀⠀⣏⣿⣿⣿⣿⣿⢴⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⣄⣷⣴⢀⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⣴⢀⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⣴⢀⠀⠁⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡷⣿⣿⣿⣿⣴⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣄⣷⣴⢀⠀

.code

; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐
; 卐                                             卐
; 卐      Получения кол-ва символа в строке      卐
; 卐                                             卐
; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐

strlen proc
    xor rax, rax
    test rcx, rcx ; проверка на NULL
    jz strlen_end
    mov rdi, rcx ; строка
    mov rcx, -1 ; для максимального значения
    repne scasb ; до нуль байта -1 - длина строки
    not rcx ; длина строки
    mov rax, rcx

strlen_end:
    ret
strlen endp

; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐
; 卐                                      卐
; 卐      Для записи данных в КОНСОЛЬ     卐
; 卐                                      卐
; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐

write proc
	; Целочисленные аргументы в первых четырех позициях передаются в порядке слева направо в
	; RCX, RDX, R8 и R9, соответственно ...
    test rdx, rdx
    jz write_end
    sub rsp, 40 ; шедоу спейс! хотя не знаю нахуя я это пишу наверное больше не буду...
    mov r8, rdx
    mov rdx, rcx
    mov rcx, r13
    mov r9, offset bw
    xor eax, eax
    mov [rsp+32], rax ; NULL
    call WriteConsoleA
    add rsp, 40
write_end:
    ret
write endp

; ⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡠⠖⠉⠉⠉⠈⠉⠉⠛⠳⢶⣤⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠎⠀⠠⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢿⣕⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⢴⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⡄⠀⢀⣀⣁⣀⣤⣦⣤⣠⣤⣦⣴⣿⣶⣿⣿⣿⣦⡀⠀⠀⠀⠀⠀⠀
; ⠀⢸⢽⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣇⢡⠿⢟⣻⢿⣿⠿⠛⠚⠿⠽⠿⢽⡟⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⠀
; ⣶⣾⣼⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢷⣿⣾⣿⣿⣿⠾⠟⠟⠻⠯⢽⣶⣾⣿⢸⣿⣿⣿⡿⠃⠀⠀⠀⠀⠀
; ⢻⡻⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣷⣶⣾⣿⣿⣿⣿⣿⣿⢿⠿⣿⣿⣿⣿⡿⠁⠀⠀⠀⠀⠀⠀
; ⠈⣷⣿⣾⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⠿⣿⣿⡿⠿⠿⠟⠋⠉⠀⠀⠀⠀⡼⣾⠿⠏⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⢻⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢟⢈⣁⣄⣐⡄⠀⠀⠀⠀⠤⠀⣍⡟⣰⡆⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠹⡿⠋⠙⣧⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢸⣿⣿⣿⣇⠀⠀⠀⠀⠀⠀⣧⣩⡿⠁⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⢹⢁⣠⣾⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠿⠋⠁⠈⠁⠀⠀⢠⠀⣰⣿⣾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⢸⣿⣿⣿⠿⠛⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣄⠀⠀⣀⣠⣶⣠⣿⣠⠿⠛⠚⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⢼⡟⠋⠁⠀⠀⠘⠧⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣴⢿⡿⣿⣿⣿⣿⣿⣷⣦⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢿⠻⠿⢿⡻⠟⠉⠀⡠⠒⠀⠈⢣⡀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠈⢣⠀⠀⠀⠀⢀⡠⠿⣄⠀⠀⠀⠀⠀⠀⠀⠀⢠⡿⠉⢈⡀⢸⣿⣿⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⢨⠗⠊⠁⠀⢀⠔⠊⠀⠀⢀⡤⠞⠻⢦⡀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⢣⣀⣤⠞⠋⠀⠀⠸⣆⠀⠀⠀⠀⠀⠀⠀⣼⣿⣀⣐⣷⣾⣿⣿⣿⣿⣿⡿⢿⣿⠀⠀⠀⠀⠀⠀⠀⠀⢠⢇⡄⠀⢀⠖⠁⠀⠀⢀⡴⠋⠀⠀⠀⠀⠹⢦⡀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠻⣀⠀⠀⠀⣠⡶⠛⢳⡄⠀⠀⠀⠀⠀⢿⣿⣛⣋⣭⣉⡉⠙⠛⢿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⢠⠏⠚⠣⠜⠁⠀⠀⠀⡰⠋⠀⠀⠀⠀⠀⠀⠀⠈⠹⢆⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠙⡄⠀⠀⠤⠀⠀⢰⣇⡀⠀⠀⠀⠀⠈⢿⠛⢨⠉⠛⠉⠀⠀⠈⣻⣵⣿⡇⠀⠀⠀⠀⠀⠀⢠⠎⠀⠀⠀⠀⡞⠢⢤⠞⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢧⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠘⡄⠀⠀⠀⠀⣴⠟⠛⢦⣀⠀⠀⠀⢸⢰⣿⠿⠀⠀⠀⠶⠾⢣⡞⢹⡇⠀⠀⠀⠀⠀⢠⠏⠀⠀⠀⣀⡼⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⡆
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣄⠀⠀⠰⣏⣀⡶⠈⣽⣷⠀⠀⢸⣿⣗⡶⠦⢀⠀⣰⢀⣼⣿⣿⠃⠀⠀⠀⠀⢠⠋⢀⣤⠶⠋⠁⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⠈
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢆⠀⠈⠁⢞⠀⣼⣿⣻⣦⠀⢸⡏⣉⣠⣤⡄⠀⣹⣿⣿⣿⣿⠀⠀⠀⠀⣰⣥⡾⠟⠁⠀⠀⠀⠀⠀⠀⢀⡞⢰⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢧⠀⢀⠈⣼⠃⣰⡿⣿⠻⡲⢿⣯⣽⣿⣿⣿⣿⡿⢟⣫⡉⢣⠀⠀⢠⣿⠋⠀⠀⢀⣀⢀⣤⠤⢤⣀⡾⠀⠉⡇⠀⠀⠀⣀⣀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢣⡘⠁⣰⠃⣼⡷⢃⣔⣿⣿⣿⣿⠿⠛⠋⣵⣾⣿⣿⠟⠻⠶⣤⣾⢡⡖⠰⠟⠉⠀⠈⡟⠀⠀⠉⠃⢠⣸⣷⡞⠉⣹⠟⣛⣿⡟⠻⣗⣶⣄⡀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠱⡄⢿⢸⡟⣠⠟⣻⠿⠛⠉⠀⢀⣀⣴⠟⠋⠉⠁⠀⠀⠀⢸⣿⠀⠀⠀⠀⢢⣀⣴⠅⠀⠀⠀⠀⠈⢹⣟⡡⣶⣃⡸⣿⣭⣴⣦⡈⢿⣿⣿
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣾⠋⠨⠉⢐⣤⣴⡶⠞⢉⢻⣿⣭⣤⣄⣠⠀⠀⡀⠀⠘⢿⣇⠀⠀⢀⣤⣯⡅⠀⠀⠀⠀⠀⠠⢸⣷⣷⢻⠙⢿⡾⢻⣷⡜⠟⣼⣿⣿
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠇⠀⠀⢰⡏⠀⠀⢲⡾⢩⣿⣿⣿⣿⣏⡊⣼⡞⠀⠀⠈⠛⣿⣦⣠⣾⣿⣿⣿⣀⢀⣀⠴⠀⠀⣻⣿⠃⠀⠑⢤⣰⣿⣋⡠⢼⣿⣿⡟
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡟⠀⠀⠀⠀⡷⠀⢻⡾⣃⣠⣏⣽⢛⣿⣿⣼⣿⠁⠀⠈⠁⠀⠙⢿⣿⡧⣿⣿⣷⡄⠀⠀⠀⠀⣀⣿⣿⣿⣿⡿⢭⣁⠈⠐⠒⢾⣿⣿⣷
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠃⠀⠀⠀⠀⡇⠀⠀⢋⣉⠙⠻⢷⣾⣾⣾⣿⡿⠀⠀⠀⣀⡀⠀⠈⠻⣇⣉⠛⣿⣃⢀⣀⡠⠚⠉⠈⠹⢤⣭⡀⠰⠈⠳⠀⠀⠀⠸⣿⡟
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡿⠀⠀⠀⠀⠀⢸⣀⠂⠀⠈⣰⠂⡞⢀⣹⡿⠹⡇⠀⠀⠀⠙⢄⠀⠀⠀⠈⠉⠀⠁⠰⡿⠋⠀⠀⠀⠀⠀⠀⠈⠛⠷⠄⢠⣤⠀⣀⠀⡉⡇
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠈⢠⣤⣄⣠⠞⣾⠒⢩⣦⣼⣀⡇⢀⡬⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠆⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣾⣵⣚⣿⣾⣱⠇
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡰⠁⠀⢀⠀⠀⠀⠀⠀⠮⢿⣯⢴⣋⣿⢹⣿⣿⣿⡇⡈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡈⢷⣦⣦⣶⣶⣶⣶⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⢡⠀⢰⢉⡀⠀⠠⠀⠀⠀⠀⠈⠙⠚⠛⠟⠛⠋⢩⢸⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣴⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠛⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠇⢠⣆⣾⣘⡛⠻⠶⣶⣶⣬⣭⣁⡒⠒⠤⣄⣀⣴⣿⠀⠀⣁⠖⠀⣠⣄⣠⣠⣴⣶⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠇⣰⠁⠜⠋⠀⢺⡉⠒⠒⠤⢭⣉⣛⠻⠿⢷⣶⣬⣭⣿⠀⠀⠉⣿⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠿⠿⠿⠿⢿⣿⣿⣿⣿⣿⡀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠃⣰⡏⠀⠀⠀⠰⠀⢳⠀⠀⠀⢀⡿⡏⠉⠉⠒⢒⣬⣍⡟⠀⠀⠀⠉⠀⠀⢻⣿⣿⡿⠟⠛⠛⠉⠉⠁⠀⠠⡆⣱⡀⠀⠀⠀⠀⠀⠀⢿⣿⣿⢧⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⢠⠃⠀⢨⠃⠀⢀⡄⣢⡉⠀⠣⣻⣴⣿⠇⢁⠀⢀⡰⠵⠛⠋⠃⠀⠀⠀⠀⠀⠀⠘⠋⠁⠀⠐⠒⠀⠐⠀⠂⠀⠀⠚⠛⠦⠤⠤⠤⠤⣄⣀⣼⡏⠙⢻⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⣠⠎⠀⢠⠇⠀⠀⠈⠳⣌⠻⣴⡶⢻⣶⣾⢿⣳⢯⠽⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⡀⢨⡀⠀


; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐
; 卐                                           卐
; 卐      TCP сокет и подключение к серверу    卐
; 卐                                           卐
; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐

socket_con proc
    push rbx
    sub rsp, 48
    mov ecx, AF_INET
    mov edx, SOCK_STREAM
    mov r8d, IPPROTO_TCP ; 32б
    call socket
    mov ebx, eax ; сокет в ecx
    cmp eax, INVALID_SOCKET
    je con_fail

    ; параметры приема
    mov dword ptr [rsp+32], SOCKET_TIMEOUT ; не работает!!!!!!!!!!!!! а может и работает
    mov ecx, ebx ; после проверки в ebx
    mov edx, SOL_SOCKET ; уровень сокета
    mov r8d, SO_RCVTIMEO ; таймаут на прием
    lea r9, [rsp+32] ; Указатель на таймаут
    mov qword ptr [rsp], 4 ; dword
    call setsockopt

    ; параметры отправки
    mov ecx, ebx ; сокет
    mov edx, SOL_SOCKET
    mov r8d, SO_SNDTIMEO
    lea r9, [rsp+32]
    mov qword ptr [rsp], 4
    call setsockopt

    mov word ptr [rsp+16], AF_INET ; 2б
    mov ecx, PORT
    call htons ; порт в NBO
    mov word ptr [rsp+18], ax ; порт в структуру
    lea rcx, ip_addr
    call inet_addr ; айпишник в 32б строку
    cmp eax, INADDR_NONE ; ошибка преобразования айпи
    je con_fail_close
    mov dword ptr [rsp+20], eax ; айпишник в структуру
    mov ecx, ebx ; сокет
    lea rdx, [rsp+16] ; Указатель sockaddr_in
    mov r8d, 16
    call connect ; ПОДКЛЮЧЕНИЕ К СЕРВАКУ
    test eax, eax ; проверка подключения
    jnz con_fail_close
    mov eax, ebx
    jmp con_end ; очистка стека
    
con_fail_close:
    mov ecx, ebx
    call closesocket
    
con_fail:
    mov eax, INVALID_SOCKET
    
con_end:
    add rsp, 48
    pop rbx
    ret
socket_con endp

;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░▒▓████████▓▒░▒▓█▓▒░      ░▒▓████████▓▒░▒▓███████▓▒░  
;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
;░▒▓████████▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓██████▓▒░ ░▒▓███████▓▒░  
;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓████████▓▒░▒▓████████▓▒░▒▓█▓▒░░▒▓█▓▒░ 


; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐
; 卐                                      卐
; 卐      Отправка данных через сокет     卐
; 卐                                      卐
; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐

send_data proc
    push rsi
    push rdi
    sub rsp, 32
    
    mov rsi, rdx ; указатель на начало данных
    mov edi, r8d ; общая длина данных
    mov ebx, ecx ; сокет
    
send_loop:
    test edi, edi ; есть ли данные для отправки
    jz send_scs ; все отправлено
    
    mov ecx, ebx ; сокет
    mov rdx, rsi
    mov r8d, edi
    xor r9d, r9d
    call send ; отправка данных

    cmp eax, SOCKET_ERR
    je send_err
    test eax, eax
    jz send_err ; соединение закрыто
    
    add rsi, rax
    sub edi, eax
    jmp send_loop
    
send_scs:
    xor eax, eax ; зоебись
    jmp send_end ; очистка
    
send_err:
    mov eax, SOCKET_ERR
    
send_end:
    add rsp, 32
    pop rdi
    pop rsi
    ret
send_data endp

; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐
; 卐                         卐
; 卐      сигнатура recv     卐
; 卐                         卐
; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐

rec_data proc
    sub rsp, 32
    xor r9d, r9d
    call recv
    add rsp, 32
    ret
rec_data endp

;      ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⢀⡠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⣀⣠⣠⣤⣴⣴⣠⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣛⣿⣿⣿⣿⣿⣿⣿⣷⣦⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠞⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⠿⣿⠿⡿⢿⡿⣿⡀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠠⢄⡀⢈⣼⣿⣿⣿⠖⣊⣁⣁⢀⣾⠀⢀⠅⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠘⠴⠆⢠⡘⡱⣟⣿⣿⣿⣿⣾⣷⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠢⣺⣈⡀⡰⣃⣜⣻⡽⣿⡿⠃⠛⠋⠛⢻⠀⠀⠀⠀⠀⠀⠀⠀MAINO.
;      ⠀⠀⠀⠀⠀⠀⠀⠈⠉⠀⠡⣋⠾⣞⣿⣿⣯⡇⠀⠀⠀⣹⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠀⠀⡀⡆⠁⠐⠘⠿⠿⣻⣧⣴⡶⣶⢮⠇⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⢀⠠⢁⣧⠠⡀⠐⠰⠒⠫⢿⣿⣧⣯⣼⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠈⢿⣦⣟⣣⠤⣔⢀⠠⠀⠀⠉⠙⠛⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⢀⠠⢔⢀⠈⢻⣿⣷⣾⣬⣗⠵⣄⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⣀⡤⢦⡑⠰⡚⡬⢡⡖⣩⠻⣿⣿⣿⣷⠚⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⣿⣭⣶⣻⠷⢨⠑⣗⣣⣽⡹⢦⡙⢿⣿⡇⢸⢹⣡⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⣿⣿⣿⢟⣟⣳⣄⠠⢫⠳⣟⡳⢗⣤⢻⠏⢘⢢⣰⣾⣽⣦⣴⡄⣀⠀⠀⠀⠀⠀
;      ⣿⣟⣻⡫⣿⢶⡭⠆⠈⡯⠝⠙⢺⣿⠧⣧⠌⢃⠓⣿⣿⣿⣿⣿⣿⣷⠢⡀⠀⠀
;      ⡙⠫⠄⠛⠫⢟⣿⣿⢀⡀⣔⠊⣨⣻⣾⢻⣻⠟⡄⢻⣿⣿⣝⣿⣿⣿⠅⣧⠀⠀
;      ⠻⣆⠁⠀⡅⢺⣿⣿⣿⡿⣌⣧⢀⠙⠻⣯⣿⣻⠀⢹⣿⣿⣿⣿⣿⣿⣇⣼⡆⠀
;      ⣦⣈⠀⠀⠨⠑⠼⢝⣿⢿⣷⣿⣾⣻⠧⣤⢻⢿⣏⢸⣿⣿⡿⣿⣿⣿⣿⣿⡅

main proc
    push r12
    push r13 ; консоль
    push r14 ; output_buf
    push r15 ; счетчик output_buf
    push rbx ; для процедур
    push rsi ; для копирования данных
    push rdi ; тоже копирование
    sub rsp, 128
    
    mov rcx, -11 ; STD_OUTPUT_HANDLE
    sub rsp, 32
    call GetStdHandle
    add rsp, 32
    mov r13, rax ; proc write
    cmp rax, -1
    je exit_err
    
    mov rcx, WSA_VERSION ; версия 2.2
    lea rdx, ws_data
    sub rsp, 32
    call WSAStartup
    add rsp, 32
    test rax, rax
    jnz exit_err
    
    call socket_con
    mov r12, rax ; сокет
    cmp rax, -1
    je clean_wsa_err
    
    lea rcx, req
    call strlen ; длина запроса
    mov req_len, rax ; и сохранение
    
    mov rcx, r12 ; сокет
    lea rdx, req
    mov r8, rax ; длина запроса
    call send_data
    cmp rax, -1
    je clean_sock
    
    lea r14, output_buf
    xor r15, r15 ; счетчик output_buf
    
rec_loop:
    mov rcx, r12 ; сокет
    lea rdx, response_buf ; Буфер для приема
    mov r8, RESP_BUF - 1 ; и размер
    call rec_data
    cmp rax, -1
    je rec_end
    test rax, rax ; не закрыто ли соединение
    jz rec_end
    
    ; данные из response_buf в output_buf
    mov rsi, offset response_buf
    mov rdi, r14
    add rdi, r15
    mov rcx, rax
    cld
    rep movsb ; rcx раз копирование байт из rsi в rdi
    add r15, rax ; output_buf б
    cmp r15, OUT_BUF - RESP_BUF ; защита от переполнения буфера))
    jl rec_loop
    
    ; вывод данных и очистка буфера
    mov rcx, r14 ; данные
    mov rdx, r15 ; буфер
    call write
    lea r14, output_buf ; сброс указателя
    xor r15, r15 ; и счетчика
    jmp rec_loop
    
rec_end:
    test r15, r15 ; есть ли output_buf
    jz skip_output
    
    mov rcx, r14 ; данные
    mov rdx, r15 ; кол-во байт
    call write
    
skip_output:
    mov rcx, r12 ; сокет
    cmp rcx, -1 ; валиден ли он
    je clean_wsa
    sub rsp, 32
    call closesocket
    add rsp, 32

clean_wsa: ; зоебись
    sub rsp, 32
    call WSACleanup
    add rsp, 32
    xor rcx, rcx
    sub rsp, 32
    call ExitProcess

exit_err: ; плохо
    add rsp, 128
    sub rsp, 32
    call WSACleanup
    add rsp, 32
    mov rcx, 1
    sub rsp, 32
    call ExitProcess

clean_sock:
    mov rcx, r12 ; сокет
    cmp rcx, -1
    je clean_wsa_err ; валидация
    sub rsp, 32
    call closesocket
    add rsp, 32

clean_wsa_err: ; ошыбка
    sub rsp, 32
    call WSACleanup
    add rsp, 32
    jmp exit_err
    
main endp
end

;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⡁⠶⠡⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠨⢄⠰⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠈⠃⣃⠐⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⠂⠀⡀⢨⣄⣠⡰⣤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⠁⠀⠀⣸⣿⣿⣿⣿⣯⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿⣿⣿⣿⣿⣿⣷⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⣤⡀⡀⠀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⣯⠖⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⠿⣿⡿⠿⠿⠿⠿⠛⠉⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠈⠈⠛⢿⣿⣿⣿⣿⡟⣉⠄⠀⠀⠀⠀⠀⠀⣀⡐⠀⠁⠀⢀⠀⠀⢀⠀⠀⠀⠀⠀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀СПАСИБО ЗА ПРОСМОТР!
;⠀⠀⠀⠀⠀⠀⠀⠀⠐⡀⡔⠃⣻⣿⣿⣿⣏⣤⣴⡧⠤⠚⠀⠀⠀⣻⡷⠀⢰⡐⠘⣔⡐⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠰⣰⡀⢿⣿⣿⣿⣿⣿⣿⣿⣧⠀⢀⣼⣽⣿⣟⠀⠀⠙⣂⢆⠐⢂⢰⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣾⣿⣿⣿⣿⣿⣿⣿⣷⣿⡿⢿⣿⣿⣿⠀⠀⠀⢼⢣⡟⣮⠖⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⢿⢹⣿⣿⣿⣿⣿⣿⣿⣿⠆⢈⣿⣿⣿⡀⠀⠀⠸⣿⢸⢁⠰⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⡿⡹⠀⡻⠛⠿⠋⠁⠀⠀⠀⡖⢡⠊⠔⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣿⣿⣿⣿⣿⣷⣾⠀⠀⠀⠀⠀⠀⠀⠀⡑⠢⣉⠒⠀⠀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⢿⣿⣿⣿⣿⣿⡿⠻⠄⠀⠀⠀⠀⠀⠀⠀⠀⠣⠔⠀⠀⠀⠱⠀⠠⣐⣒⡂⠄⣀⡀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⡞⣿⣿⣿⣿⣟⢀⣠⣴⡶⠒⠀⠀⠀⡀⠀⠄⠡⠀⠀⠀⠀⠀⠀⠀⠹⣚⡽⣖⠙⠿⣷⣶⣤⣤
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣼⣿⣷⡙⣿⠿⣿⡼⣟⣏⣃⠀⣀⣀⣀⡰⡀⠀⠀⠂⠀⠀⠀⠀⠀⠀⠀⠀⠘⢹⡆⢅⡀⠻⡿⢿⣿
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣿⣿⣿⣿⣿⣦⡳⢎⡉⢿⣿⣿⣿⡿⡟⠿⠡⠑⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢈⠄⠹⢠⠂⠄⠀⢹⣿
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⢻⣿⣿⣿⣿⣿⣿⡏⡵⣍⡂⠍⠉⠁⠀⠈⠀⠁⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠀⢂⠁⡍⠌⢂⠀⠩
;⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⠃⣼⢸⣿⣿⣿⣟⡻⠛⢵⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢊⡀⠄⢂⠐⣈⠢⡈⠄
;⠀⠀⠀⠀⠀⠀⢠⣾⣳⣟⢠⣿⠊⣿⣿⣿⣿⣯⣷⣀⡌⠚⢰⠃⠐⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢂⠷⠈⡠⢇⢈⠖⡡⢫
;⠀⠀⠀⠀⠀⢀⣼⣿⣿⣿⣿⣾⡄⢿⣁⠹⣿⣿⣿⣿⣿⣴⣥⠂⠁⣀⣠⣤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⠀⠀⢁⡞⣓⠄⢣⡈⢲⢅⠹
;⠀⠀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⡇⠘⣿⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀⠀⠀⠀⠀⠀⠀⡀⠀⠀⠀⠈⠀⠰⢬⡑⣮⠔⡘⡡⢎⡘
;⣰⣿⣿⣿⣿⡿⠛⠿⣿⣿⣿⣿⣧⠀⣿⣿⣿⣿⣿⣙⠿⣿⣿⣿⣿⣿⡿⠀⠀⡀⡀⠀⠀⠀⠀⠂⠐⣭⠀⣠⠄⠌⡒⡬⢷⣗⢶⡡⣟⡘
;⣿⣿⣿⣿⣿⣿⣿⣿⣮⠛⡗⠀⠀⠂⢹⣿⣿⣿⡥⡛⢤⡌⠻⢿⣿⣿⠁⢠⢖⡳⠀⠀⠀⠀⠀⠀⠀⠁⢎⠄⣗⠢⢵⣜⣷⣿⣭⡟⣤⠋
;⣿⣿⣿⣿⣿⣿⡋⢿⡿⢰⢀⠀⠀⠀⠀⠙⠿⣷⡿⠀⠙⣼⣆⠀⠙⠁⢠⠔⡤⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⢘⠰⠃⣜⡲⣿⣿⡷⡺⣵⢉
;⣿⣿⡉⢿⡏⠀⡇⢸⠃⢸⠀⠀⣄⠀⠀⠀⠀⠙⢻⣄⠈⣷⢿⢆⠀⠒⡠⢂⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠂⢹⢠⠿⠵⣿⣚⢗⡧⠏
;⣿⢿⣧⣘⣇⠀⡇⠀⠀⣿⠄⠈⢿⡅⠀⠀⠀⠀⢀⢨⢕⡸⢿⣿⢶⣄⠳⡌⢌⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⢘⢞⠭⢓⠋⡋⠇⣃
