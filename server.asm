;	   /\       /\
;	  / ".-'"'-." \
;	 ;   _     _   ;
;	 ;  (o)   (o) _;_       __________________________________
;	  \   = Y =  (,,,)     /\                                 \
;	   '   '-'   | -,      \_|    Автор: xaquake              |
;	  .(________/   ;        |    Дата: 01.2025               |
;	 . __ (MASM) '  ;        |    Компилятор: MASM64          |
;	/     )        ,         |    Проект: Сервер привет Влад  |
;	;  --'          ;        |   _____________________________|_
;	 . __  . , __  .          \_/_______________________________/
;	  (,,,)   (,,,)
; 
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡀⢐⡂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣤⣤⣴⣶⣾⣿⣟⣭⣿⣿⣿⣿⣿⣦⣛⠲⣤⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣾⣿⣿⣿⣿⣿⣿⠿⠷⢋⣉⣿⣿⣿⣿⣿⣿⣿⣅⠛⣿⣿⣷⣦⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣶⣿⣿⣿⣿⣿⣿⡏⠉⣭⣤⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣜⡛⠻⣿⣿⣿⣿⣦⣄⠀⠀⠀⠀⠀⠀⠀Libs: kernel32.lib ws2_32.lib⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣿⣿⣿⣿⣭⡴⢶⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣤⢙⣿⣿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⣿⣿⣿⣿⣿⣿⣿⣠⢶⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣌⠻⢿⣿⣿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⣿⣿⣿⣿⣿⣿⣿⢋⣡⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠷⣆⣽⣿⣿⣿⣿⣿⣿⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⣏⠠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⢉⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⡿⡷⠌⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠌⠙⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣷⡘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⣿⣿⣿⣿⣿⣿⣿⣀⠺⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⢸⣿⣿⣿⣿⣿⣿⠟⣃⣤⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⢸⣿⣿⣿⣿⣿⡿⠶⣌⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣿⡿⠿⡿⠿⣿⣿⣿⡆⢸⣿⣿⡿⣛⣉⣉⣙⣿⣟⣛⣻⣿⣿⣿⡆⣽⣯⣥⣴⣶⣶⣾⣝⠿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣿⣿⣿⣿⣷⣶⣶⣦⣽⣧⣬⣭⣬⣾⣿⠏⠉⠉⠛⠛⠻⠿⢿⣿⣿⣿⡜⢿⣿⣿⣿⣿⣿⡋⠑⢦⣍⣋⣙⠻⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⢀⣠⢶⣿⣿⣿⠟⣩⡿⠛⠉⠉⢠⣿⣿⣿⣿⢳⣿⠀⠀⠀⠀⠀⠀⠀⠀⠙⣿⣿⣿⣮⠻⣿⣿⣿⣿⣿⣿⣦⣽⣿⣿⣷⡌⢿⣿⣿⣿⡿⠀⠀⢀⠀⠀⠀⠀
; ⠀⠀⣠⣶⡿⠗⠺⣿⡏⢾⣿⣿⠃⣼⡏⠀⠀⠀⢀⣾⣿⣿⣿⣿⡇⢿⡄⠀⠀⠀⠀⠀⠀⠀⠀⢹⣿⣿⣿⣷⣬⣝⡛⠛⠿⠿⠿⠛⣛⣛⣭⣴⠎⣿⣿⡿⠁⠀⣰⣿⣿⡄⠀⠀
; ⠀⠀⣿⣿⣷⣶⣤⣼⣷⢸⣿⠃⢸⣿⠁⠀⠀⠀⣸⣿⣿⣿⣿⣿⣷⣄⠹⣦⣤⣀⡀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣥⣾⡿⠋⠀⠀⣼⣿⣿⣿⣷⠀⠀
; ⠀⠀⣿⣿⣿⣿⣿⣿⣿⠘⣿⡀⢸⡿⠀⠀⠀⢠⣿⣿⠋⣠⡶⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣶⣾⣿⣿⣿⣿⣿⣿⡿⠛⠛⠛⠛⠛⠉⠉⢛⡟⠋⠀⠀⣠⡞⢻⣿⣿⣿⣿⡀⠀
; ⠀⢸⣿⣿⣿⣿⠀⣿⣿⣤⣿⣿⣾⣷⣤⣤⣶⣿⣿⠇⣸⠏⠀⠀⠙⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀⠀⠀⢠⣶⣿⣿⣿⠋⠀⣀⣴⡾⠿⣿⣄⠙⣻⢿⣿⠀⡀
; ⠀⣿⣿⣿⣿⣿⠃⣿⡋⢻⣿⣿⣿⣿⣿⣿⣿⣿⡟⢠⠇⠀⠀⠀⠀⠀⠹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⣿⣿⣿⣿⠃⣴⣿⣿⣿⣿⣶⣦⣬⡀⢻⣶⣾⣄⣏
; ⠀⣿⣿⣿⣿⣿⣄⣿⣧⠀⢻⣿⣿⠟⣩⣿⣿⣿⡇⣼⠀⠀⠀⠀⠀⠀⠀⢹⣿⣿⣿⡿⠟⠛⠛⠛⠉⠻⠿⣿⣧⣤⣄⠀⠀⣿⣿⣿⠇⢰⣿⣿⣿⣿⣿⣿⣿⣿⠃⢠⣿⣿⡯⣏
; ⠀⣿⣿⣿⡿⣿⣿⣿⣿⣷⡀⠛⠋⢸⣿⣿⣿⣿⣷⣿⣤⣴⣿⣿⣶⣤⣴⣿⣿⠟⣡⣾⣿⣿⣿⣿⣿⣷⣶⠀⣸⣿⣿⣷⣄⣿⣿⡿⢀⣿⣿⣿⣿⣿⣿⣿⣿⣿⡀⣿⣿⣿⡿⣯
; ⠀⠙⣟⣅⠘⣿⡛⠻⣿⣿⣷⡄⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢀⣿⣿⣿⣿⣿⣿⣿⡇⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⠃⢿⣿⡿⠀⢀
; ⣴⣿⣿⣿⣧⠙⢿⣦⣄⡙⠻⠿⣆⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠇⢸⣿⣿⣿⣿⣿⣿⣿⠇⠀⠉⣉⣉⣉⣁⣀⣀⠐⣾⣶⣶⣿⡄⠀⠀
; ⠘⣿⣿⣿⣿⡧⣸⣿⣿⣿⣿⣿⣶⡀⢸⣿⡟⠛⣟⠻⣿⣛⠻⢟⠻⠿⢟⣛⡟⢉⣉⣉⢱⣲⡯⣴⣶⡟⠀⣿⣿⣿⣿⣿⣿⣿⣿⠰⣿⣿⣿⣿⣿⣿⣿⣿⠘⣿⣿⣿⣿⣿⠀⣄
; ⠀⢻⣿⣿⣿⠇⣿⣿⣿⠿⢿⣿⣿⣧⢠⡇⣿⡔⣿⣗⣿⣿⢶⣿⣿⡷⣿⣿⣿⣾⣿⣿⢸⣿⠇⠟⣛⣅⢰⣿⣿⣿⣿⣿⣿⣿⡏⢰⣿⣿⣿⣿⣿⣿⣿⣿⠆⠙⣿⣿⣿⣿⠀⠀
; ⠀⢸⣿⣟⣫⡄⠨⣥⣴⣶⣿⣿⣿⣿⢨⡇⣹⡁⣛⡏⠻⠛⠛⣿⣛⠃⢛⣻⣏⣨⣭⣥⢸⣿⣿⣿⣿⡇⣸⣿⣿⣿⣿⣿⣿⣿⡇⢸⣿⣿⣿⣿⣿⣿⣿⡇⠈⣷⣌⠻⣿⡏⠀⠀
; ⠀⠀⠛⣫⣤⣶⣦⡀⠉⠉⠉⢛⣿⣿⠚⣇⣿⡇⣿⣿⣿⣿⡇⢿⣿⡿⢺⣿⣿⣿⣿⣿⢸⣿⠇⢛⣩⣡⣿⣿⣿⣿⣿⣿⠟⠋⠀⠈⣿⣿⣿⣿⡿⢋⣤⣤⣄⡈⢻⣷⣌⠃⠀⠀
; ⠀⠀⢸⣿⣿⣿⣿⣿⡆⢰⣿⡿⠋⠁⠀⢹⣾⣧⣌⣛⣘⣛⣃⣘⣛⣃⣘⣛⣫⣬⣭⣥⣴⣶⣿⣟⣵⣿⣿⣿⣿⡿⠛⠁⠀⠀⠀⠀⠈⢿⣿⣿⡇⢸⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀
; ⠀⠀⢸⣿⣿⣿⡿⠿⠟⠛⠁⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠛⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⣿⣧⡘⠻⣿⣿⣿⣿⣿⡇⠀⠀⠀
; ⠀⠀⠘⠛⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣿⣿⣿⣿⣿⠟⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠻⢶⣮⣛⣿⣿⣿⠃⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣧⣼⣶⣦⣍⡙⠻⠿⠟⢛⣋⣩⣴⣿⣿⣿⠿⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠉⠛⠉⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⠻⠿⠛⠛⠛⠛⠻⠿⠿⠿⠿⠟⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀


extrn ExitProcess:proc
extrn WSAStartup:proc
extrn WSACleanup:proc
extrn socket:proc
extrn bind:proc
extrn listen:proc
extrn accept:proc
extrn send:proc
extrn closesocket:proc
extrn htons:proc
extrn SetConsoleCtrlHandler:proc
extrn GetCurrentThreadId:proc
extrn GetStdHandle:proc
extrn WriteConsoleA:proto
extrn select:proc

; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐
; 卐                                    卐
; 卐      wsd 404 байта для Winsock     卐
; 卐      scadrr 16 байт для адреса     卐
; 卐      port 8080                     卐
; 卐      sigint для сигналинга         卐
; 卐                                    卐
; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐

.data
wsd db 404 dup(0)
scadrr db 16 dup(0)
port equ 8080
sigint db 0

; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐
; 卐                         卐
; 卐      Ответ сервера      卐
; 卐                         卐
; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐

resp db "HTTP/1.1 200 OK", 13, 10
     db "Content-Type: text/plain", 13, 10
     db 13, 10
     db "privet vlad!", 13, 10
resp_len equ $ - resp

; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐
; 卐                         卐
; 卐       Логирование       卐
; 卐                         卐
; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐

STD_OUTPUT_HANDLE equ -11 ; Дескриптор потока вывода в консоль
msg db "exit", 13, 0
msg_len equ $ - msg
bw dq 0

; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐
; 卐                         卐
; 卐        Сигналинг        卐
; 卐                         卐
; 卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐卐

rfd dq 1 dup(?)
    dq 64 dup(?)
tvs dd 0, 0

;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠋⡿⢿⠙⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⢴⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⣴⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⣴⢀⠀⠀⠀⠀⠋⡿⢿⠉⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⡷⣿⣿⣿⣿⣿⢉⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⢿⠙⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⣄⣷⣿⣿⣿⣿⢻⠘⠋⡿⣿⣿⣿⣿⣿⣿⣿⣿⢿⠉⠀⠀⠀
;	⠀⠋⡿⠻⠉⠀⠀⠀⠀⣄⣷⣿⣿⣿⣿⣿⣿⣿⣿⣴⢀⣄⣶⣿⣿⣿⣿⠿⠙⠀
;	⡷⣿⣿⣿⣿⠿⠉⠀⠀⠁⠀⣏⣿⣿⣿⣿⣿⣿⢘⠀⠀⠀⠀⣀⣶⣿⣿⣿⣿⢴
;	⠀⣄⣷⣿⣿⣿⣿⠿⠉⠋⡿⣿⣿⣿⣿⣿⣿⣿⣿⢻⠙⠀⠀⠀⠀⣄⣧⣴⢀⠀
;	⠀⠀⠀⣄⣷⣿⣿⣿⣿⣿⣿⣿⣿⣴⢀⣄⣷⣿⣿⣿⣿⠿⠈⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⣄⣷⣿⣿⣿⣿⣴⢀⠀⠀⠀⠀⣏⣿⣿⣿⣿⣿⢴⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⣄⣷⣴⢀⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⣴⢀⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠋⡿⣿⣿⣿⣿⣴⢀⠀⠁⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡷⣿⣿⣿⣿⣴⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;	⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣄⣷⣴⢀⠀⠀

.code
handle proc
    mov byte ptr [sigint], 1
    mov rax, 1
    ret
handle endp

; ⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡠⠖⠉⠉⠉⠈⠉⠉⠛⠳⢶⣤⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠎⠀⠠⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢿⣕⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⢴⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⡄⠀⢀⣀⣁⣀⣤⣦⣤⣠⣤⣦⣴⣿⣶⣿⣿⣿⣦⡀⠀⠀⠀⠀⠀⠀
; ⠀⢸⢽⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣇⢡⠿⢟⣻⢿⣿⠿⠛⠚⠿⠽⠿⢽⡟⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⠀
; ⣶⣾⣼⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢷⣿⣾⣿⣿⣿⠾⠟⠟⠻⠯⢽⣶⣾⣿⢸⣿⣿⣿⡿⠃⠀⠀⠀⠀⠀
; ⢻⡻⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣷⣶⣾⣿⣿⣿⣿⣿⣿⢿⠿⣿⣿⣿⣿⡿⠁⠀⠀⠀⠀⠀⠀
; ⠈⣷⣿⣾⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⠿⣿⣿⡿⠿⠿⠟⠋⠉⠀⠀⠀⠀⡼⣾⠿⠏⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⢻⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢟⢈⣁⣄⣐⡄⠀⠀⠀⠀⠤⠀⣍⡟⣰⡆⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠹⡿⠋⠙⣧⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢸⣿⣿⣿⣇⠀⠀⠀⠀⠀⠀⣧⣩⡿⠁⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⢹⢁⣠⣾⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠿⠋⠁⠈⠁⠀⠀⢠⠀⣰⣿⣾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⢸⣿⣿⣿⠿⠛⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣄⠀⠀⣀⣠⣶⣠⣿⣠⠿⠛⠚⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⢼⡟⠋⠁⠀⠀⠘⠧⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣴⢿⡿⣿⣿⣿⣿⣿⣷⣦⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢿⠻⠿⢿⡻⠟⠉⠀⡠⠒⠀⠈⢣⡀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠈⢣⠀⠀⠀⠀⢀⡠⠿⣄⠀⠀⠀⠀⠀⠀⠀⠀⢠⡿⠉⢈⡀⢸⣿⣿⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⢨⠗⠊⠁⠀⢀⠔⠊⠀⠀⢀⡤⠞⠻⢦⡀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⢣⣀⣤⠞⠋⠀⠀⠸⣆⠀⠀⠀⠀⠀⠀⠀⣼⣿⣀⣐⣷⣾⣿⣿⣿⣿⣿⡿⢿⣿⠀⠀⠀⠀⠀⠀⠀⠀⢠⢇⡄⠀⢀⠖⠁⠀⠀⢀⡴⠋⠀⠀⠀⠀⠹⢦⡀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠻⣀⠀⠀⠀⣠⡶⠛⢳⡄⠀⠀⠀⠀⠀⢿⣿⣛⣋⣭⣉⡉⠙⠛⢿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⢠⠏⠚⠣⠜⠁⠀⠀⠀⡰⠋⠀⠀⠀⠀⠀⠀⠀⠈⠹⢆⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠙⡄⠀⠀⠤⠀⠀⢰⣇⡀⠀⠀⠀⠀⠈⢿⠛⢨⠉⠛⠉⠀⠀⠈⣻⣵⣿⡇⠀⠀⠀⠀⠀⠀⢠⠎⠀⠀⠀⠀⡞⠢⢤⠞⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢧⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠘⡄⠀⠀⠀⠀⣴⠟⠛⢦⣀⠀⠀⠀⢸⢰⣿⠿⠀⠀⠀⠶⠾⢣⡞⢹⡇⠀⠀⠀⠀⠀⢠⠏⠀⠀⠀⣀⡼⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⡆
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣄⠀⠀⠰⣏⣀⡶⠈⣽⣷⠀⠀⢸⣿⣗⡶⠦⢀⠀⣰⢀⣼⣿⣿⠃⠀⠀⠀⠀⢠⠋⢀⣤⠶⠋⠁⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⠈
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢆⠀⠈⠁⢞⠀⣼⣿⣻⣦⠀⢸⡏⣉⣠⣤⡄⠀⣹⣿⣿⣿⣿⠀⠀⠀⠀⣰⣥⡾⠟⠁⠀⠀⠀⠀⠀⠀⢀⡞⢰⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢧⠀⢀⠈⣼⠃⣰⡿⣿⠻⡲⢿⣯⣽⣿⣿⣿⣿⡿⢟⣫⡉⢣⠀⠀⢠⣿⠋⠀⠀⢀⣀⢀⣤⠤⢤⣀⡾⠀⠉⡇⠀⠀⠀⣀⣀⠀⠀⠀⠀⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢣⡘⠁⣰⠃⣼⡷⢃⣔⣿⣿⣿⣿⠿⠛⠋⣵⣾⣿⣿⠟⠻⠶⣤⣾⢡⡖⠰⠟⠉⠀⠈⡟⠀⠀⠉⠃⢠⣸⣷⡞⠉⣹⠟⣛⣿⡟⠻⣗⣶⣄⡀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠱⡄⢿⢸⡟⣠⠟⣻⠿⠛⠉⠀⢀⣀⣴⠟⠋⠉⠁⠀⠀⠀⢸⣿⠀⠀⠀⠀⢢⣀⣴⠅⠀⠀⠀⠀⠈⢹⣟⡡⣶⣃⡸⣿⣭⣴⣦⡈⢿⣿⣿
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣾⠋⠨⠉⢐⣤⣴⡶⠞⢉⢻⣿⣭⣤⣄⣠⠀⠀⡀⠀⠘⢿⣇⠀⠀⢀⣤⣯⡅⠀⠀⠀⠀⠀⠠⢸⣷⣷⢻⠙⢿⡾⢻⣷⡜⠟⣼⣿⣿
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠇⠀⠀⢰⡏⠀⠀⢲⡾⢩⣿⣿⣿⣿⣏⡊⣼⡞⠀⠀⠈⠛⣿⣦⣠⣾⣿⣿⣿⣀⢀⣀⠴⠀⠀⣻⣿⠃⠀⠑⢤⣰⣿⣋⡠⢼⣿⣿⡟
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡟⠀⠀⠀⠀⡷⠀⢻⡾⣃⣠⣏⣽⢛⣿⣿⣼⣿⠁⠀⠈⠁⠀⠙⢿⣿⡧⣿⣿⣷⡄⠀⠀⠀⠀⣀⣿⣿⣿⣿⡿⢭⣁⠈⠐⠒⢾⣿⣿⣷
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠃⠀⠀⠀⠀⡇⠀⠀⢋⣉⠙⠻⢷⣾⣾⣾⣿⡿⠀⠀⠀⣀⡀⠀⠈⠻⣇⣉⠛⣿⣃⢀⣀⡠⠚⠉⠈⠹⢤⣭⡀⠰⠈⠳⠀⠀⠀⠸⣿⡟
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡿⠀⠀⠀⠀⠀⢸⣀⠂⠀⠈⣰⠂⡞⢀⣹⡿⠹⡇⠀⠀⠀⠙⢄⠀⠀⠀⠈⠉⠀⠁⠰⡿⠋⠀⠀⠀⠀⠀⠀⠈⠛⠷⠄⢠⣤⠀⣀⠀⡉⡇
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠈⢠⣤⣄⣠⠞⣾⠒⢩⣦⣼⣀⡇⢀⡬⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠆⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣾⣵⣚⣿⣾⣱⠇
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡰⠁⠀⢀⠀⠀⠀⠀⠀⠮⢿⣯⢴⣋⣿⢹⣿⣿⣿⡇⡈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡈⢷⣦⣦⣶⣶⣶⣶⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⢡⠀⢰⢉⡀⠀⠠⠀⠀⠀⠀⠈⠙⠚⠛⠟⠛⠋⢩⢸⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣴⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠛⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠇⢠⣆⣾⣘⡛⠻⠶⣶⣶⣬⣭⣁⡒⠒⠤⣄⣀⣴⣿⠀⠀⣁⠖⠀⣠⣄⣠⣠⣴⣶⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠇⣰⠁⠜⠋⠀⢺⡉⠒⠒⠤⢭⣉⣛⠻⠿⢷⣶⣬⣭⣿⠀⠀⠉⣿⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠿⠿⠿⠿⢿⣿⣿⣿⣿⣿⡀⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠃⣰⡏⠀⠀⠀⠰⠀⢳⠀⠀⠀⢀⡿⡏⠉⠉⠒⢒⣬⣍⡟⠀⠀⠀⠉⠀⠀⢻⣿⣿⡿⠟⠛⠛⠉⠉⠁⠀⠠⡆⣱⡀⠀⠀⠀⠀⠀⠀⢿⣿⣿⢧⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⠀⢠⠃⠀⢨⠃⠀⢀⡄⣢⡉⠀⠣⣻⣴⣿⠇⢁⠀⢀⡰⠵⠛⠋⠃⠀⠀⠀⠀⠀⠀⠘⠋⠁⠀⠐⠒⠀⠐⠀⠂⠀⠀⠚⠛⠦⠤⠤⠤⠤⣄⣀⣼⡏⠙⢻⠀⠀
; ⠀⠀⠀⠀⠀⠀⠀⣠⠎⠀⢠⠇⠀⠀⠈⠳⣌⠻⣴⡶⢻⣶⣾⢿⣳⢯⠽⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⡀⢨⡀⠀


main proc
    sub rsp, 28h
	
   ; ██╗ █████╗ ██████╗  █████╗ 
   ;███║██╔══██╗╚════██╗██╔══██╗
   ;╚██║╚██████║ █████╔╝╚██████║
   ; ██║ ╚═══██║ ╚═══██╗ ╚═══██║
   ; ██║ █████╔╝██████╔╝ █████╔╝
   ; ╚═╝ ╚════╝ ╚═════╝  ╚════╝ 
	
    ; Обработка сигналинга
    lea rcx, handle
    mov rdx, 1
    call SetConsoleCtrlHandler
    
    ; Вызов Winsock
    mov rcx, 202h
    lea rdx, wsd
    call WSAStartup
    
    ; Создание сокета
    mov rcx, 2
    mov rdx, 1
    mov r8, 6
    call socket
    mov rbx, rax
    
    ; 127.1.1.0:8080 localhost:8080
    lea rdi, scadrr
    mov word ptr [rdi], 2
    mov rcx, port
    call htons
    mov word ptr [rdi+2], ax
    mov dword ptr [rdi+4], 0
    
    ; Прослушивание сервера
    mov rcx, rbx
    lea rdx, scadrr
    mov r8, 16
    call bind
    mov rcx, rbx
    mov rdx, 5
    call listen

;      ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⢀⡠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⣀⣠⣠⣤⣴⣴⣠⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣛⣿⣿⣿⣿⣿⣿⣿⣷⣦⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠞⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⠿⣿⠿⡿⢿⡿⣿⡀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠠⢄⡀⢈⣼⣿⣿⣿⠖⣊⣁⣁⢀⣾⠀⢀⠅⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠘⠴⠆⢠⡘⡱⣟⣿⣿⣿⣿⣾⣷⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠢⣺⣈⡀⡰⣃⣜⣻⡽⣿⡿⠃⠛⠋⠛⢻⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠀⠈⠉⠀⠡⣋⠾⣞⣿⣿⣯⡇⠀⠀⠀⣹⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠀⠀⡀⡆⠁⠐⠘⠿⠿⣻⣧⣴⡶⣶⢮⠇⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⢀⠠⢁⣧⠠⡀⠐⠰⠒⠫⢿⣿⣧⣯⣼⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⠀⠀⠈⢿⣦⣟⣣⠤⣔⢀⠠⠀⠀⠉⠙⠛⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⠀⠀⠀⢀⠠⢔⢀⠈⢻⣿⣷⣾⣬⣗⠵⣄⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⠀⣀⡤⢦⡑⠰⡚⡬⢡⡖⣩⠻⣿⣿⣿⣷⠚⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⣿⣭⣶⣻⠷⢨⠑⣗⣣⣽⡹⢦⡙⢿⣿⡇⢸⢹⣡⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;      ⣿⣿⣿⢟⣟⣳⣄⠠⢫⠳⣟⡳⢗⣤⢻⠏⢘⢢⣰⣾⣽⣦⣴⡄⣀⠀⠀⠀⠀⠀
;      ⣿⣟⣻⡫⣿⢶⡭⠆⠈⡯⠝⠙⢺⣿⠧⣧⠌⢃⠓⣿⣿⣿⣿⣿⣿⣷⠢⡀⠀⠀
;      ⡙⠫⠄⠛⠫⢟⣿⣿⢀⡀⣔⠊⣨⣻⣾⢻⣻⠟⡄⢻⣿⣿⣝⣿⣿⣿⠅⣧⠀⠀
;      ⠻⣆⠁⠀⡅⢺⣿⣿⣿⡿⣌⣧⢀⠙⠻⣯⣿⣻⠀⢹⣿⣿⣿⣿⣿⣿⣇⣼⡆⠀
;      ⣦⣈⠀⠀⠨⠑⠼⢝⣿⢿⣷⣿⣾⣻⠧⣤⢻⢿⣏⢸⣿⣿⡿⣿⣿⣿⣿⣿⡅⠀

serv_loop:
    ; Проверка флага прерывания
    cmp byte ptr [sigint], 1
    je clean
    
    ; Черт его знает
    lea rax, rfd
    mov qword ptr [rax], 1
    mov [rax+8], rbx
    
    ; Вызов handle
    xor rcx, rcx
    lea rdx, rfd
    xor r8, r8
    xor r9, r9
    lea rax, tvs
    mov [rsp+20h], rax
    call select
    
    ; Проверка handle
    cmp rax, 0
    jle pass
    
    ; Получение соединения
    mov rcx, rbx
    xor rdx, rdx
    xor r8, r8
    call accept
    mov rsi, rax
    
    ; Проверерка сокета
    cmp rax, -1
    je pass
    
    ; Отправка ответа
    mov rcx, rsi
    lea rdx, resp
    mov r8, resp_len
    xor r9, r9
    call send
    
    ; Закрытие соединения
    mov rcx, rsi
    call closesocket
    jmp serv_loop
	
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⡁⠶⠡⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠨⢄⠰⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠈⠃⣃⠐⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⠂⠀⡀⢨⣄⣠⡰⣤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⠁⠀⠀⣸⣿⣿⣿⣿⣯⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿⣿⣿⣿⣿⣿⣷⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⣤⡀⡀⠀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⣯⠖⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⠿⣿⡿⠿⠿⠿⠿⠛⠉⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠈⠈⠛⢿⣿⣿⣿⣿⡟⣉⠄⠀⠀⠀⠀⠀⠀⣀⡐⠀⠁⠀⢀⠀⠀⢀⠀⠀⠀⠀⠀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠐⡀⡔⠃⣻⣿⣿⣿⣏⣤⣴⡧⠤⠚⠀⠀⠀⣻⡷⠀⢰⡐⠘⣔⡐⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠰⣰⡀⢿⣿⣿⣿⣿⣿⣿⣿⣧⠀⢀⣼⣽⣿⣟⠀⠀⠙⣂⢆⠐⢂⢰⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣾⣿⣿⣿⣿⣿⣿⣿⣷⣿⡿⢿⣿⣿⣿⠀⠀⠀⢼⢣⡟⣮⠖⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⢿⢹⣿⣿⣿⣿⣿⣿⣿⣿⠆⢈⣿⣿⣿⡀⠀⠀⠸⣿⢸⢁⠰⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⡿⡹⠀⡻⠛⠿⠋⠁⠀⠀⠀⡖⢡⠊⠔⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣿⣿⣿⣿⣿⣷⣾⠀⠀⠀⠀⠀⠀⠀⠀⡑⠢⣉⠒⠀⠀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⢿⣿⣿⣿⣿⣿⡿⠻⠄⠀⠀⠀⠀⠀⠀⠀⠀⠣⠔⠀⠀⠀⠱⠀⠠⣐⣒⡂⠄⣀⡀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⡞⣿⣿⣿⣿⣟⢀⣠⣴⡶⠒⠀⠀⠀⡀⠀⠄⠡⠀⠀⠀⠀⠀⠀⠀⠹⣚⡽⣖⠙⠿⣷⣶⣤⣤
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣼⣿⣷⡙⣿⠿⣿⡼⣟⣏⣃⠀⣀⣀⣀⡰⡀⠀⠀⠂⠀⠀⠀⠀⠀⠀⠀⠀⠘⢹⡆⢅⡀⠻⡿⢿⣿
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣿⣿⣿⣿⣿⣦⡳⢎⡉⢿⣿⣿⣿⡿⡟⠿⠡⠑⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢈⠄⠹⢠⠂⠄⠀⢹⣿
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⢻⣿⣿⣿⣿⣿⣿⡏⡵⣍⡂⠍⠉⠁⠀⠈⠀⠁⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠀⢂⠁⡍⠌⢂⠀⠩
;⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⠃⣼⢸⣿⣿⣿⣟⡻⠛⢵⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢊⡀⠄⢂⠐⣈⠢⡈⠄
;⠀⠀⠀⠀⠀⠀⢠⣾⣳⣟⢠⣿⠊⣿⣿⣿⣿⣯⣷⣀⡌⠚⢰⠃⠐⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢂⠷⠈⡠⢇⢈⠖⡡⢫
;⠀⠀⠀⠀⠀⢀⣼⣿⣿⣿⣿⣾⡄⢿⣁⠹⣿⣿⣿⣿⣿⣴⣥⠂⠁⣀⣠⣤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⠀⠀⢁⡞⣓⠄⢣⡈⢲⢅⠹
;⠀⠀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⡇⠘⣿⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀⠀⠀⠀⠀⠀⠀⡀⠀⠀⠀⠈⠀⠰⢬⡑⣮⠔⡘⡡⢎⡘
;⣰⣿⣿⣿⣿⡿⠛⠿⣿⣿⣿⣿⣧⠀⣿⣿⣿⣿⣿⣙⠿⣿⣿⣿⣿⣿⡿⠀⠀⡀⡀⠀⠀⠀⠀⠂⠐⣭⠀⣠⠄⠌⡒⡬⢷⣗⢶⡡⣟⡘
;⣿⣿⣿⣿⣿⣿⣿⣿⣮⠛⡗⠀⠀⠂⢹⣿⣿⣿⡥⡛⢤⡌⠻⢿⣿⣿⠁⢠⢖⡳⠀⠀⠀⠀⠀⠀⠀⠁⢎⠄⣗⠢⢵⣜⣷⣿⣭⡟⣤⠋
;⣿⣿⣿⣿⣿⣿⡋⢿⡿⢰⢀⠀⠀⠀⠀⠙⠿⣷⡿⠀⠙⣼⣆⠀⠙⠁⢠⠔⡤⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⢘⠰⠃⣜⡲⣿⣿⡷⡺⣵⢉
;⣿⣿⡉⢿⡏⠀⡇⢸⠃⢸⠀⠀⣄⠀⠀⠀⠀⠙⢻⣄⠈⣷⢿⢆⠀⠒⡠⢂⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠂⢹⢠⠿⠵⣿⣚⢗⡧⠏
;⣿⢿⣧⣘⣇⠀⡇⠀⠀⣿⠄⠈⢿⡅⠀⠀⠀⠀⢀⢨⢕⡸⢿⣿⢶⣄⠳⡌⢌⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⢘⢞⠭⢓⠋⡋⠇⣃

pass:
    ; Заглушка
    jmp serv_loop

;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░▒▓████████▓▒░▒▓█▓▒░      ░▒▓████████▓▒░▒▓███████▓▒░  
;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
;░▒▓████████▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓██████▓▒░ ░▒▓███████▓▒░  
;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
;░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░  ░▒▓█▓▒░   ░▒▓████████▓▒░▒▓████████▓▒░▒▓█▓▒░░▒▓█▓▒░ 

clean:
    ; Логирование и очистка при сигналинге
    mov rcx, STD_OUTPUT_HANDLE
    call GetStdHandle
    mov rcx, rax
    lea rdx, msg
    mov r8, msg_len
    lea r9, bw
    mov qword ptr [rsp+20h], 0
    call WriteConsoleA
    call WSACleanup
    xor rcx, rcx
    call ExitProcess
    
main endp
end

;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣠⣤⠤⢤⣔⣒⣒⣒⣒⣠⠤⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⡤⣶⣿⣿⣷⣛⣿⣍⣉⣏⣂⢠⣤⣄⠀⢩⣝⠛⠶⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣶⣾⣽⣿⣿⣿⣿⣷⣷⠻⠟⣿⡿⠿⠿⠷⢦⡿⢾⣿⣽⣷⣄⠀⠙⢳⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣴⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡍⠻⣦⣄⣲⣤⡀⣀⣰⡀⣩⣿⡄⠰⣄⡙⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣿⣿⡏⠉⠹⣿⡋⠻⣶⣿⣿⣧⣤⣾⣷⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣤⣴⣿⣃⠈⠿⣿⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣿⢿⣿⣛⣛⣛⣟⣟⠉⢙⣛⡻⢿⡿⠷⣦⣿⣿⣿⣿⣿⣿⠇⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣻⣿⣿⣿⣶⣶⣿⣿⣿⣿⣿⠻⠙⠁⣴⡞⢋⡓⢮⡹⣷⣦⣝⢿⣿⣿⣿⡟⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠆⠀⠐⢿⣷⣌⠃⣸⡇⠀⢿⣿⣧⣿⣿⡟⠁⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⠿⡿⣿⢶⣄⣀⣘⠉⠛⠿⠋⠀⠀⣸⣿⣯⣿⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⣿⣿⡿⢛⣭⣿⠛⠉⣹⢫⣭⣽⣿⣿⣖⣛⣫⠭⠭⠽⠽⡿⠿⠿⠭⠭⠽⢿⣒⣲⣾⡭⣟⡁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢿⣿⣿⣿⣿⣿⡷⢛⣯⣾⣶⣿⣿⣖⣛⣯⣭⣿⣷⣶⣶⡿⠿⠿⢿⣿⣿⣿⣿⣿⣷⣶⣶⣾⣿⣭⡓⢿⡷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠛⠻⣿⣿⣤⣼⣟⣯⣷⣿⣿⣿⣿⠛⠛⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠁⠀⠉⠁⠈⠙⣿⣿⣷⣽⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⣫⣿⣿⣿⣿⣿⣾⣿⣿⣛⣒⣤⣤⣤⣀⣀⣀⣀⣀⣀⣀⣀⣀⡀⠀⠀⠀⠀⠀⠈⢿⣿⣯⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡼⢿⣿⣿⡿⡏⠉⠈⠉⠙⠛⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣶⠟⠻⠿⠆⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣶⣤⡉⠁⠀⠀⠀⠀⠀⠀⠛⠿⠟⠻⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣿⣿⢀⣹⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⢤⣀⣀⣉⣽⡿⢻⠿⠿⠛⠁⠹⣿⡿⠟⠛⢻⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣿⢸⡟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡾⠁⠀⠀⠀⠀⠏⠻⢶⠖⠁⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠦⢉⣀⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⡁⢀⣀⣀⠀⢀⠸⡄⠀⠈⢒⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢦⠀⠀⣤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣾⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠛⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡼⠋⠀⠺⣿⣿⣿⣿⣿⣿⡟⠛⣧⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠋⢀⠄⠀⠀⠀⠀⠀⠀⠀⠀⠜⠁⠠⣴⣾⣛⣿⣿⣿⣿⣿⠀⠀⠈⢡⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⢸⡄⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⠿⠛⠉⠉⢉⣉⣉⣉⠉⢻⣖⠀⣼⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡀⠘⢆⡄⠀⠀⠀⠶⠈⠚⣧⠌⠁⠀⠀⣀⣿⣿⣿⣿⣿⠏⠀⢹⣷⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⠃⢧⣀⢸⢿⡄⠀⢰⣿⣤⣴⣿⣦⡀⠀⠀⠀⠀⠀⠈⠉⠁⠀⠀⣼⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⠀⠈⠹⣞⢯⣻⣦⣤⣿⣿⣿⣿⣿⣿⣦⣀⣐⣤⣀⣀⣰⣄⣀⣸⡿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⡿⣿⡄⠀⠀⠈⠻⣧⡙⢿⣿⣿⣿⣿⣻⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⠞⠋⠀⣤⣧⢿⣆⠀⠀⠀⠈⠛⠶⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣾⡿⠃⠀⠀⠀⠀⠚⠒⠛⣦⡀⠀⠀⠀⠀⠀⠙⠻⢿⣿⣿⣿⣿⣟⣭⡿⠟⠁⠀⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣠⠶⠚⢉⣿⣿⡏⠀⠀⠀⠀⠀⠀⣇⠀⠘⠙⢷⡄⠀⠀⠀⠀⠀⠀⠀⠉⠙⢿⣿⠟⠁⠀⠀⠀⢰⡟⢦⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⢀⣠⡴⠶⠚⠉⠁⠀⠀⠄⢨⣿⡟⠀⠀⠀⠀⠀⠀⠀⠈⣧⡀⠀⠨⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣦⡀⠀⠀⠀⢸⡇⠀⠉⠛⢦⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠤⠔⠋⠉⠀⠀⠀⠀⠀⠀⠀⠀⢀⣼⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢣⡄⢠⠘⣧⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣿⠀⠀⠀⠘⣧⠀⢠⡀⠀⠈⡛⠳⢦⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢩⣿⠃⠀⠀⠀⡆⠀⠀⠀⠀⠀⠀⠀⠀⢿⢰⡀⠈⢳⣄⠀⠀⠀⠰⢿⣿⣿⣿⠟⣧⠀⠀⠀⣿⡀⢸⣿⡄⣤⢿⣆⠠⠀⠈⠙⢳⣤⡀⠀⠀⠀⠀
;⠀⠀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠀⠀⠀⢀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠈⠘⣷⣠⢀⠻⣆⠀⠀⠀⢸⣿⣿⣿⠀⠘⡄⠀⢀⡿⢹⣾⡅⠖⡈⠈⠻⣧⣂⡖⠀⠀⠀⠙⠶⣄⠀⠀
;⠀⠀⠀⠀⢀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⡷⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣯⣽⣾⣧⣽⣷⡄⠀⣾⣿⣿⣿⣦⠀⠉⠀⢸⡇⠘⢿⣿⡀⢷⠀⠀⠹⣿⣷⣴⡄⠀⠀⠀⠈⢻⡆
;⣆⠀⢀⡞⣼⡇⣠⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢧⠀⠀⠀⠀⠀⢀⣠⣠⣤⣾⢻⣿⣿⣿⣿⣯⣷⣄⣿⣿⣿⣿⣿⣆⠀⠀⢸⣷⡄⣿⣿⣿⡄⠇⠀⠀⠘⢿⣿⡿⠀⠀⠀⠀⢨⡜
;⠻⣧⡻⣷⢿⣿⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⢀⠐⣠⣄⣿⣿⣿⣿⠛⢷⠟⣵⠏⠻⠛⢿⣿⣿⣿⣿⣿⣿⣿⡀⠀⢸⡿⢀⣿⡿⣿⣿⣌⣟⣧⡀⠈⢿⡄⠀⠀⠀⠀⠀⠇
;⣦⣈⡟⠹⣾⠛⣿⣿⣏⠀⠀⠀⠀⠀⠠⠄⠀⠸⠻⣶⡶⠟⠛⠋⠉⣽⣿⠇⠀⠀⠘⠉⠤⠀⠀⠰⣶⡿⢿⣿⣿⣿⣿⣧⠀⢸⡇⠀⠟⣅⡿⠙⠿⢷⣯⣅⣀⡀⠁⠀⠀⠀⠀⠀⢨
;⣿⣿⣷⣄⠹⣦⡰⣿⣿⠀⠀⠀⠀⢀⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣿⣿⠂⠀⠀⠀⠀⠀⠀⠤⢤⣾⡃⠨⢿⣿⣿⣿⣿⣇⣸⡇⠀⠀⠻⡆⠀⠀⠀⠘⠉⠻⣿⠃⠀⠀⠀⠀⠀⠸
;⢻⣿⣿⠹⣷⣌⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠀⣿⡿⢃⠀⠀⠀⠀⠀⠀⠘⠀⠀⠘⢻⣿⣾⣿⣿⣿⣿⣿⡿⠘⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⢸⣿⣷⣌⢻⣿⣿⣿⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣷⣄⣠⣀⡀⠀⠀⠀⠀⠀⠀⠈⠋⣁⢚⢿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠀⠀⠀⠀⠀⠀⠀
;⣶⣄⠙⠿⣿⣦⡹⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⠻⣾⣿⣷⣤⠀⠀⠀⠀⠀⠀⡈⡉⠀⢿⣿⣿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣼⠏⠀⠀⠀⠀⠀⠀⠀
;⠈⢻⣷⣤⡈⠻⢿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠛⠳⢧⣤⣤⡀⠀⠠⡄⠁⠀⠈⣿⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⡞⠁⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠻⡿⠿⣷⣦⣽⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠻⣿⣷⠄⠀⠤⣄⣠⣿⡇⠀⠀⠀⠀⠀⠀⠀⢀⣾⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
;⠀⠀⠀⠀⠀⣀⡈⢹⣿⣿⣛⣛⣂⣀⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠿⣷⣶⣋⣿⣿⠁⠀⠀⠀⠀⠀⣀⣴⡿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
